/**
 * BackWerk Multi-Store Employee Time Tracker
 * Google Apps Script for automatic spreadsheet creation and data management
 * 
 * FIXED VERSION - Ensures all tabs are created properly
 */

// Configuration
const SPREADSHEET_NAME = 'BackWerk Time Tracker - Employee Hours';
const SCRIPT_PROPERTY_KEY = 'BACKWERK_SPREADSHEET_ID';

// Store configurations
const STORES = {
  'BackWerk Frankenthal': {
    employees: ['Waqas', 'Yan', 'Gizem', 'Irfan', 'Najat', 'Atta', 'Ayesha', 'Melek'],
    color: '#ff6b6b'
  },
  'BackWerk Offenburg': {
    employees: ['Shazia', 'Kamran', 'Hussain', 'Mohan', 'Nilab', 'Nandini'],
    color: '#4ecdc4'
  },
  'BackWerk Karlsruhe': {
    employees: ['Furqan', 'Hamza', 'Dilpreet', 'Yaseen'],
    color: '#45b7d1'
  },
  'Back-Factory Karlsruhe': {
    employees: ['Nabeel', 'Lubna', 'Nosheen', 'Rabia'],
    color: '#feca57'
  }
};

/**
 * STEP 1: RUN THIS FIRST - Initialize the complete system
 */
function initializeBackWerkTimeTracker() {
  try {
    console.log('üöÄ Starting BackWerk Time Tracker initialization...');
    
    // Check if spreadsheet already exists
    let spreadsheetId = getStoredSpreadsheetId();
    let spreadsheet;
    
    if (spreadsheetId) {
      try {
        spreadsheet = SpreadsheetApp.openById(spreadsheetId);
        console.log('üìä Found existing spreadsheet:', spreadsheet.getName());
        console.log('üîÑ Recreating all sheets to ensure they exist...');
      } catch (error) {
        console.log('‚ö†Ô∏è Stored spreadsheet not accessible, creating new one...');
        spreadsheet = createNewSpreadsheet();
      }
    } else {
      spreadsheet = createNewSpreadsheet();
    }
    
    // Setup all sheets (this will recreate them if needed)
    setupAllSheets(spreadsheet);
    
    // Verify all sheets were created
    const sheets = spreadsheet.getSheets();
    console.log('üìã Created sheets:', sheets.map(s => s.getName()));
    
    // Log the spreadsheet URL
    const url = spreadsheet.getUrl();
    console.log('‚úÖ BackWerk Time Tracker initialized successfully!');
    console.log('üìã Spreadsheet URL:', url);
    console.log('üîë Spreadsheet ID:', spreadsheet.getId());
    console.log('üìä Total sheets created:', sheets.length);
    
    // Return success response
    return {
      success: true,
      spreadsheetId: spreadsheet.getId(),
      spreadsheetUrl: url,
      totalSheets: sheets.length,
      sheetNames: sheets.map(s => s.getName()),
      message: 'System initialized successfully! All tabs have been created.'
    };
    
  } catch (error) {
    console.error('‚ùå Error initializing system:', error);
    throw error; // Re-throw so you can see the error
  }
}

/**
 * Creates a new spreadsheet and stores its ID
 */
function createNewSpreadsheet() {
  const spreadsheet = SpreadsheetApp.create(SPREADSHEET_NAME);
  const spreadsheetId = spreadsheet.getId();
  
  // Store the ID for future use
  storeSpreadsheetId(spreadsheetId);
  
  console.log('üìù Created new spreadsheet:', SPREADSHEET_NAME);
  console.log('üÜî Spreadsheet ID:', spreadsheetId);
  
  // Wait a moment for Google to process the creation
  Utilities.sleep(1000);
  
  return spreadsheet;
}

/**
 * Sets up ALL sheets in the spreadsheet
 */
function setupAllSheets(spreadsheet) {
  console.log('üîß Setting up all sheets...');
  
  // Get existing sheets
  const existingSheets = spreadsheet.getSheets();
  console.log('üìã Existing sheets before setup:', existingSheets.map(s => s.getName()));
  
  // Remove default Sheet1 if it exists and we have other sheets to create
  const defaultSheet = spreadsheet.getSheetByName('Sheet1');
  if (defaultSheet && existingSheets.length === 1) {
    // We'll delete it after creating other sheets
    console.log('üóëÔ∏è Will remove default Sheet1 after creating new sheets');
  }
  
  // Create Master Summary sheet FIRST
  console.log('üìä Creating Master Summary sheet...');
  createMasterSummarySheet(spreadsheet);
  
  // Create individual store sheets
  console.log('üè™ Creating store sheets...');
  Object.keys(STORES).forEach(storeName => {
    console.log(`  üìã Creating sheet for: ${storeName}`);
    createStoreSheet(spreadsheet, storeName);
  });
  
  // Create Monthly Reports sheet
  console.log('üìà Creating Monthly Reports sheet...');
  createMonthlyReportsSheet(spreadsheet);
  
  // Create Dashboard sheet
  console.log('üìä Creating Dashboard sheet...');
  createDashboardSheet(spreadsheet);
  
  // Now delete the default sheet if it still exists
  const finalDefaultSheet = spreadsheet.getSheetByName('Sheet1');
  if (finalDefaultSheet) {
    try {
      spreadsheet.deleteSheet(finalDefaultSheet);
      console.log('üóëÔ∏è Deleted default Sheet1');
    } catch (error) {
      console.log('‚ö†Ô∏è Could not delete Sheet1:', error.message);
    }
  }
  
  // Final verification
  const finalSheets = spreadsheet.getSheets();
  console.log('‚úÖ Final sheets created:', finalSheets.map(s => s.getName()));
  console.log(`‚úÖ Total sheets: ${finalSheets.length}`);
}

/**
 * Creates the Master Summary sheet
 */
function createMasterSummarySheet(spreadsheet) {
  const sheetName = 'üìä Master Summary';
  
  // Delete existing sheet if it exists
  let sheet = spreadsheet.getSheetByName(sheetName);
  if (sheet) {
    spreadsheet.deleteSheet(sheet);
  }
  
  // Create new sheet
  sheet = spreadsheet.insertSheet(sheetName);
  
  // Set up headers
  const headers = [
    'Entry ID', 'Date', 'Store', 'Employee', 'Start Time', 'End Time', 
    'Hours Worked', 'Submitted By', 'Submitted At', 'Status'
  ];
  
  const headerRange = sheet.getRange(1, 1, 1, headers.length);
  headerRange.setValues([headers]);
  
  // Format headers
  headerRange.setBackground('#4285f4');
  headerRange.setFontColor('#ffffff');
  headerRange.setFontWeight('bold');
  headerRange.setHorizontalAlignment('center');
  headerRange.setBorder(true, true, true, true, true, true);
  
  // Set column widths
  const columnWidths = [120, 100, 180, 120, 100, 100, 120, 140, 160, 100];
  columnWidths.forEach((width, index) => {
    sheet.setColumnWidth(index + 1, width);
  });
  
  // Freeze header row
  sheet.setFrozenRows(1);
  
  // Add some sample formatting
  sheet.getRange(2, 1, 1, headers.length).setBackground('#f8f9fa');
  
  console.log('‚úÖ Master Summary sheet created successfully');
}

/**
 * Creates individual store sheets
 */
function createStoreSheet(spreadsheet, storeName) {
  const sheetName = `üè™ ${storeName}`;
  
  // Delete existing sheet if it exists
  let sheet = spreadsheet.getSheetByName(sheetName);
  if (sheet) {
    spreadsheet.deleteSheet(sheet);
  }
  
  // Create new sheet
  sheet = spreadsheet.insertSheet(sheetName);
  
  // Get store config
  const storeConfig = STORES[storeName];
  const employees = storeConfig?.employees || [];
  const storeColor = storeConfig?.color || '#ff6b6b';
  
  // Add store title
  sheet.getRange(1, 1, 1, 7).merge();
  sheet.getRange(1, 1).setValue(`üè™ ${storeName} - Employee Time Tracking`);
  sheet.getRange(1, 1).setBackground(storeColor);
  sheet.getRange(1, 1).setFontColor('#ffffff');
  sheet.getRange(1, 1).setFontWeight('bold');
  sheet.getRange(1, 1).setHorizontalAlignment('center');
  sheet.getRange(1, 1).setFontSize(14);
  
  // Employee Summary Section
  createEmployeeSummarySection(sheet, storeName, employees, storeColor);
  
  // Time Entries Section
  createTimeEntriesSection(sheet, storeColor);
  
  // Set column widths
  const columnWidths = [120, 120, 100, 100, 120, 140, 160];
  columnWidths.forEach((width, index) => {
    sheet.setColumnWidth(index + 1, width);
  });
  
  console.log(`‚úÖ Store sheet created: ${storeName}`);
}

/**
 * Creates employee summary section in store sheet
 */
function createEmployeeSummarySection(sheet, storeName, employees, storeColor) {
  const startRow = 3;
  
  // Section title
  sheet.getRange(startRow, 1, 1, 7).merge();
  sheet.getRange(startRow, 1).setValue(`üë• Employee Summary - ${storeName}`);
  sheet.getRange(startRow, 1).setBackground('#f1f3f4');
  sheet.getRange(startRow, 1).setFontWeight('bold');
  sheet.getRange(startRow, 1).setHorizontalAlignment('center');
  
  // Summary headers
  const summaryHeaders = ['Employee', 'This Week (hrs)', 'This Month (hrs)', 'Total Hours', 'Last Entry'];
  const headerRow = startRow + 1;
  sheet.getRange(headerRow, 1, 1, summaryHeaders.length).setValues([summaryHeaders]);
  sheet.getRange(headerRow, 1, 1, summaryHeaders.length).setBackground('#e8f0fe');
  sheet.getRange(headerRow, 1, 1, summaryHeaders.length).setFontWeight('bold');
  sheet.getRange(headerRow, 1, 1, summaryHeaders.length).setBorder(true, true, true, true, true, true);
  
  // Add employee rows
  employees.forEach((employee, index) => {
    const row = headerRow + 1 + index;
    const rowData = [employee, 0, 0, 0, 'No entries yet'];
    sheet.getRange(row, 1, 1, rowData.length).setValues([rowData]);
    
    // Alternate row colors
    if (index % 2 === 0) {
      sheet.getRange(row, 1, 1, rowData.length).setBackground('#f8f9fa');
    }
    sheet.getRange(row, 1, 1, rowData.length).setBorder(true, true, true, true, false, false);
  });
}

/**
 * Creates time entries section in store sheet
 */
function createTimeEntriesSection(sheet, storeColor) {
  const startRow = 15; // Start after employee summary
  
  // Section title
  sheet.getRange(startRow, 1, 1, 7).merge();
  sheet.getRange(startRow, 1).setValue('üìã Time Entries');
  sheet.getRange(startRow, 1).setBackground('#f1f3f4');
  sheet.getRange(startRow, 1).setFontWeight('bold');
  sheet.getRange(startRow, 1).setHorizontalAlignment('center');
  
  // Time entries headers
  const entryHeaders = ['Date', 'Employee', 'Start Time', 'End Time', 'Hours Worked', 'Submitted By', 'Submitted At'];
  const headerRow = startRow + 1;
  sheet.getRange(headerRow, 1, 1, entryHeaders.length).setValues([entryHeaders]);
  sheet.getRange(headerRow, 1, 1, entryHeaders.length).setBackground(storeColor);
  sheet.getRange(headerRow, 1, 1, entryHeaders.length).setFontColor('#ffffff');
  sheet.getRange(headerRow, 1, 1, entryHeaders.length).setFontWeight('bold');
  sheet.getRange(headerRow, 1, 1, entryHeaders.length).setBorder(true, true, true, true, true, true);
  
  // Add a sample row for formatting
  const sampleRow = headerRow + 1;
  sheet.getRange(sampleRow, 1, 1, entryHeaders.length).setBackground('#f8f9fa');
  sheet.getRange(sampleRow, 1).setValue('Sample entries will appear here');
}

/**
 * Creates Monthly Reports sheet
 */
function createMonthlyReportsSheet(spreadsheet) {
  const sheetName = 'üìà Monthly Reports';
  
  // Delete existing sheet if it exists
  let sheet = spreadsheet.getSheetByName(sheetName);
  if (sheet) {
    spreadsheet.deleteSheet(sheet);
  }
  
  // Create new sheet
  sheet = spreadsheet.insertSheet(sheetName);
  
  // Add title
  sheet.getRange(1, 1, 1, 8).merge();
  sheet.getRange(1, 1).setValue('üìà Monthly Reports - All Stores');
  sheet.getRange(1, 1).setBackground('#34a853');
  sheet.getRange(1, 1).setFontColor('#ffffff');
  sheet.getRange(1, 1).setFontWeight('bold');
  sheet.getRange(1, 1).setHorizontalAlignment('center');
  sheet.getRange(1, 1).setFontSize(14);
  
  // Set up headers
  const headers = [
    'Month/Year', 'Store', 'Employee', 'Total Hours', 'Total Days', 
    'Average Hours/Day', 'Overtime Hours', 'Status'
  ];
  
  const headerRange = sheet.getRange(3, 1, 1, headers.length);
  headerRange.setValues([headers]);
  
  // Format headers
  headerRange.setBackground('#34a853');
  headerRange.setFontColor('#ffffff');
  headerRange.setFontWeight('bold');
  headerRange.setHorizontalAlignment('center');
  headerRange.setBorder(true, true, true, true, true, true);
  
  // Set column widths
  const columnWidths = [120, 180, 120, 120, 100, 140, 120, 100];
  columnWidths.forEach((width, index) => {
    sheet.setColumnWidth(index + 1, width);
  });
  
  // Freeze header row
  sheet.setFrozenRows(3);
  
  console.log('‚úÖ Monthly Reports sheet created successfully');
}

/**
 * Creates Dashboard sheet
 */
function createDashboardSheet(spreadsheet) {
  const sheetName = 'üéØ Dashboard';
  
  // Delete existing sheet if it exists
  let sheet = spreadsheet.getSheetByName(sheetName);
  if (sheet) {
    spreadsheet.deleteSheet(sheet);
  }
  
  // Create new sheet
  sheet = spreadsheet.insertSheet(sheetName);
  
  // Add title
  sheet.getRange(1, 1, 1, 6).merge();
  sheet.getRange(1, 1).setValue('üéØ BackWerk Time Tracker Dashboard');
  sheet.getRange(1, 1).setBackground('#6c5ce7');
  sheet.getRange(1, 1).setFontColor('#ffffff');
  sheet.getRange(1, 1).setFontWeight('bold');
  sheet.getRange(1, 1).setHorizontalAlignment('center');
  sheet.getRange(1, 1).setFontSize(16);
  
  // Add store summary section
  let currentRow = 3;
  sheet.getRange(currentRow, 1, 1, 4).merge();
  sheet.getRange(currentRow, 1).setValue('üìä Store Summary');
  sheet.getRange(currentRow, 1).setBackground('#f1f3f4');
  sheet.getRange(currentRow, 1).setFontWeight('bold');
  sheet.getRange(currentRow, 1).setHorizontalAlignment('center');
  
  currentRow += 2;
  const storeHeaders = ['Store Name', 'Total Employees', 'Active Today', 'Weekly Hours'];
  sheet.getRange(currentRow, 1, 1, storeHeaders.length).setValues([storeHeaders]);
  sheet.getRange(currentRow, 1, 1, storeHeaders.length).setBackground('#ddd6fe');
  sheet.getRange(currentRow, 1, 1, storeHeaders.length).setFontWeight('bold');
  sheet.getRange(currentRow, 1, 1, storeHeaders.length).setBorder(true, true, true, true, true, true);
  
  // Add store data
  Object.keys(STORES).forEach((storeName, index) => {
    const row = currentRow + 1 + index;
    const employees = STORES[storeName].employees;
    const rowData = [storeName, employees.length, 0, 0];
    sheet.getRange(row, 1, 1, rowData.length).setValues([rowData]);
    
    if (index % 2 === 0) {
      sheet.getRange(row, 1, 1, rowData.length).setBackground('#f8f9fa');
    }
    sheet.getRange(row, 1, 1, rowData.length).setBorder(true, true, true, true, false, false);
  });
  
  // Set column widths
  const columnWidths = [200, 120, 120, 120];
  columnWidths.forEach((width, index) => {
    sheet.setColumnWidth(index + 1, width);
  });
  
  console.log('‚úÖ Dashboard sheet created successfully');
}

/**
 * STEP 2: Web App Handler - Handle form submissions
 */
function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    console.log('üì® Received request:', data.action);
    
    switch (data.action) {
      case 'addTimeEntry':
        return addTimeEntry(data.data);
      case 'getEmployeeRecords':
        return getEmployeeRecords(data.employee, data.store);
      case 'getStoreData':
        return getStoreData(data.store);
      case 'generateReport':
        return generateReport(data.store, data.startDate, data.endDate);
      default:
        return createResponse(false, 'Unknown action: ' + data.action);
    }
  } catch (error) {
    console.error('‚ùå Error in doPost:', error);
    return createResponse(false, 'Server error: ' + error.toString());
  }
}

/**
 * Adds a time entry to the spreadsheet
 */
function addTimeEntry(timeEntry) {
  try {
    console.log('‚è∞ Adding time entry for:', timeEntry.employee);
    
    const spreadsheet = getSpreadsheet();
    if (!spreadsheet) {
      return createResponse(false, 'Spreadsheet not found. Please run initialization first.');
    }
    
    // Generate entry ID if not provided
    if (!timeEntry.id) {
      timeEntry.id = 'TE_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5);
    }
    
    // Add timestamp if not provided
    if (!timeEntry.submittedAt) {
      timeEntry.submittedAt = new Date().toISOString();
    }
    
    // Add to Master Summary
    addToMasterSummary(spreadsheet, timeEntry);
    
    // Add to Store Sheet
    addToStoreSheet(spreadsheet, timeEntry);
    
    // Update employee summaries
    updateEmployeeSummary(spreadsheet, timeEntry);
    
    console.log('‚úÖ Time entry added successfully for:', timeEntry.employee);
    
    return createResponse(true, 'Time entry added successfully', {
      entryId: timeEntry.id,
      employee: timeEntry.employee,
      store: timeEntry.store,
      hours: timeEntry.hoursWorked,
      date: timeEntry.date
    });
    
  } catch (error) {
    console.error('‚ùå Error adding time entry:', error);
    return createResponse(false, 'Error adding time entry: ' + error.toString());
  }
}

/**
 * Adds entry to Master Summary sheet
 */
function addToMasterSummary(spreadsheet, timeEntry) {
  const sheet = spreadsheet.getSheetByName('üìä Master Summary');
  if (!sheet) {
    console.error('Master Summary sheet not found');
    return;
  }
  
  const lastRow = sheet.getLastRow();
  const newRow = lastRow + 1;
  
  const rowData = [
    timeEntry.id,
    timeEntry.date,
    timeEntry.store,
    timeEntry.employee,
    timeEntry.startTime,
    timeEntry.endTime,
    parseFloat(timeEntry.hoursWorked),
    timeEntry.submittedBy || 'System',
    new Date(timeEntry.submittedAt),
    'Active'
  ];
  
  sheet.getRange(newRow, 1, 1, rowData.length).setValues([rowData]);
  
  // Format the new row
  const range = sheet.getRange(newRow, 1, 1, rowData.length);
  range.setBorder(true, true, true, true, false, false);
  
  // Alternate row coloring
  if (newRow % 2 === 0) {
    range.setBackground('#f8f9fa');
  }
  
  console.log('üìä Added to Master Summary at row:', newRow);
}

/**
 * Adds entry to Store Sheet
 */
function addToStoreSheet(spreadsheet, timeEntry) {
  const sheetName = `üè™ ${timeEntry.store}`;
  const sheet = spreadsheet.getSheetByName(sheetName);
  if (!sheet) {
    console.error('Store sheet not found:', sheetName);
    return;
  }
  
  // Find the time entries section (starts around row 16)
  const dataStartRow = 17; // After the headers in time entries section
  const lastRow = Math.max(sheet.getLastRow(), dataStartRow - 1);
  const newRow = lastRow + 1;
  
  const rowData = [
    timeEntry.date,
    timeEntry.employee,
    timeEntry.startTime,
    timeEntry.endTime,
    parseFloat(timeEntry.hoursWorked),
    timeEntry.submittedBy || 'System',
    new Date(timeEntry.submittedAt)
  ];
  
  sheet.getRange(newRow, 1, 1, rowData.length).setValues([rowData]);
  
  // Format the new row
  const range = sheet.getRange(newRow, 1, 1, rowData.length);
  range.setBorder(true, true, true, true, false, false);
  
  // Alternate row coloring
  if ((newRow - dataStartRow) % 2 === 0) {
    range.setBackground('#f8f9fa');
  }
  
  console.log('üè™ Added to store sheet at row:', newRow);
}

/**
 * Updates employee summary in store sheet
 */
function updateEmployeeSummary(spreadsheet, timeEntry) {
  const sheetName = `üè™ ${timeEntry.store}`;
  const sheet = spreadsheet.getSheetByName(sheetName);
  if (!sheet) return;
  
  const employees = STORES[timeEntry.store]?.employees || [];
  const employeeIndex = employees.indexOf(timeEntry.employee);
  
  if (employeeIndex === -1) {
    console.log('‚ö†Ô∏è Employee not found in store config:', timeEntry.employee);
    return;
  }
  
  const summaryRow = 5 + employeeIndex; // Employee summary starts at row 5
  
  try {
    // Update last entry date
    sheet.getRange(summaryRow, 5).setValue(new Date());
    
    // Update total hours (simplified - adds to existing total)
    const currentTotal = sheet.getRange(summaryRow, 4).getValue() || 0;
    const newTotal = parseFloat(currentTotal) + parseFloat(timeEntry.hoursWorked);
    sheet.getRange(summaryRow, 4).setValue(newTotal);
    
    // Update this month hours (simplified)
    const currentMonth = sheet.getRange(summaryRow, 3).getValue() || 0;
    const newMonth = parseFloat(currentMonth) + parseFloat(timeEntry.hoursWorked);
    sheet.getRange(summaryRow, 3).setValue(newMonth);
    
    console.log('üìä Updated summary for employee:', timeEntry.employee);
  } catch (error) {
    console.error('Error updating employee summary:', error);
  }
}

/**
 * UTILITY FUNCTIONS
 */

function getSpreadsheet() {
  const spreadsheetId = getStoredSpreadsheetId();
  if (!spreadsheetId) {
    console.error('No spreadsheet ID found in properties');
    return null;
  }
  
  try {
    return SpreadsheetApp.openById(spreadsheetId);
  } catch (error) {
    console.error('Error opening spreadsheet:', error);
    return null;
  }
}

function getStoredSpreadsheetId() {
  return PropertiesService.getScriptProperties().getProperty(SCRIPT_PROPERTY_KEY);
}

function storeSpreadsheetId(spreadsheetId) {
  PropertiesService.getScriptProperties().setProperty(SCRIPT_PROPERTY_KEY, spreadsheetId);
  console.log('üíæ Stored spreadsheet ID:', spreadsheetId);
}

function createResponse(success, message, data = null) {
  const response = {
    success: success,
    message: message,
    data: data,
    timestamp: new Date().toISOString()
  };
  
  return ContentService.createTextOutput(JSON.stringify(response))
    .setMimeType(ContentService.MimeType.JSON);
}

/**
 * STEP 3: Get current system info
 */
function getSpreadsheetInfo() {
  const spreadsheetId = getStoredSpreadsheetId();
  
  if (!spreadsheetId) {
    console.log('‚ùå No spreadsheet found');
    return {
      exists: false,
      message: 'No spreadsheet found. Run initializeBackWerkTimeTracker() first.'
    };
  }
  
  try {
    const spreadsheet = SpreadsheetApp.openById(spreadsheetId);
    const sheets = spreadsheet.getSheets().map(sheet => ({
      name: sheet.getName(),
      rows: sheet.getLastRow(),
      columns: sheet.getLastColumn()
    }));
    
    console.log('‚úÖ Spreadsheet info retrieved');
    console.log('üìä Sheets:', sheets.map(s => s.name));
    
    return {
      exists: true,
      spreadsheetId: spreadsheetId,
      spreadsheetName: spreadsheet.getName(),
      spreadsheetUrl: spreadsheet.getUrl(),
      sheets: sheets,
      lastModified: spreadsheet.getLastUpdated(),
      totalSheets: sheets.length
    };
    
  } catch (error) {
    console.error('‚ùå Error getting spreadsheet info:', error);
    return {
      exists: false,
      error: error.toString(),
      message: 'Stored spreadsheet ID is invalid. Run initializeBackWerkTimeTracker() to create a new one.'
    };
  }
}

/**
 * STEP 4: Test function to add sample data
 */
function addSampleData() {
  const sampleEntries = [
    {
      date: '2024-01-15',
      store: 'BackWerk Frankenthal',
      employee: 'Waqas',
      startTime: '09:00',
      endTime: '17:00',
      hoursWorked: 8,
      submittedBy: 'Manager'
    },
    {
      date: '2024-01-15',
      store: 'BackWerk Offenburg',
      employee: 'Shazia',
      startTime: '10:00',
      endTime: '18:00',
      hoursWorked: 8,
      submittedBy: 'Manager'
    },
    {
      date: '2024-01-15',
      store: 'BackWerk Karlsruhe',
      employee: 'Furqan',
      startTime: '08:00',
      endTime: '16:00',
      hoursWorked: 8,
      submittedBy: 'Manager'
    }
  ];
  
  console.log('üìù Adding sample data...');
  
  sampleEntries.forEach((entry, index) => {
    const result = addTimeEntry(entry);
    console.log(`Sample ${index + 1}:`, result.success ? '‚úÖ' : '‚ùå', result.message);
  });
  
  console.log('‚úÖ Sample data added');
  return 'Sample data added successfully!';
}

/**
 * STEP 5: Reset system if needed
 */
function resetSystem() {
  const currentId = getStoredSpreadsheetId();
  
  if (currentId) {
    try {
      const currentSpreadsheet = SpreadsheetApp.openById(currentId);
      console.log('üóëÔ∏è Deleting old spreadsheet:', currentSpreadsheet.getName());
      DriveApp.getFileById(currentId).setTrashed(true);
    } catch (error) {
      console.log('‚ö†Ô∏è Could not delete old spreadsheet:', error.toString());
    }
  }
  
  // Clear stored ID
  PropertiesService.getScriptProperties().deleteProperty(SCRIPT_PROPERTY_KEY);
  console.log('üßπ Cleared stored properties');
  
  // Initialize new system
  return initializeBackWerkTimeTracker();
}
